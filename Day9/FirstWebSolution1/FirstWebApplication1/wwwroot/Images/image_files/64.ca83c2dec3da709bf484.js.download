(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{484:function(e,t,n){"use strict";n.r(t),n.d(t,"searchByImageInitialize",(function(){return H}));n(9),n(64),n(13),n(3),n(700),n(708),n(710),n(711),n(713),n(716),n(717),n(718),n(719),n(720),n(721),n(722),n(723),n(725),n(726),n(727),n(728),n(729),n(730),n(731),n(732),n(733),n(734),n(18),n(15),n(248),n(186),n(5);var r,a=n(0),i=function(){var e=Object(a.d)('[data-search="image"]');e.length>0&&e.forEach((function(e){return function(e){var t=BASE64_SEARCH_BY_IMAGE;if(t&&t.split(",").length>0){for(var n=atob(t.split(",")[1]),r=new Uint8Array(n.length),a=0;a<n.length;a++)r[a]=n.charCodeAt(a);var i=URL.createObjectURL(new Blob([r],{type:"image/png"}));e.style.backgroundImage="url("+i+")"}}(e)}))},c=n(82),s=n(2),o=n(1),u=n.n(o),d=(n(17),n(342)),l=(n(75),n(86),n(38)),f=n(803),h=n(4),v=n(287),p=function(e){function t(t,n){var r;return(r=e.call(this,t)||this).message=t,r.fileExtension=n,r}return Object(l.a)(t,e),t}(Object(f.a)(Error)),m={"Invalid file min dimensions":{message:Object(h.a)(v.b,v.j,v.j),event:"dimension"},"Invalid file size":{message:Object(h.a)(v.c,v.h),event:"size"},"Invalid file type":{message:Object(h.a)(v.e,v.q[0],v.q[1]),event:"format"},Error:{message:Object(h.a)(v.d),event:"unknown"}},b=function(){var e=Object(a.c)("#"+v.p);return{form:Object(a.c)("#"+v.n),errorElement:Object(a.c)(".form-alert",e)}},g=function(){var e=b().errorElement;e&&e.classList.add("hide")},w=function(e){var t,n=b(),r=n.errorElement,i=n.form;if(r){var c=Object(a.c)("span",r);if(c){var s=(null===(t=m[e.message])||void 0===t?void 0:t.message)||m.Error.message;c.textContent=s,r.classList.remove("hide"),i.classList.remove("is-uploading"),Object(a.c)("#"+v.a).value=""}}},j=function(){var e=Object(s.a)(u.a.mark((function e(t,r){var a,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(143).then(n.t.bind(null,866,7));case 2:return a=e.sent,i=a.default,e.next=6,i().resize(t,r,{unsharpAmount:80,unsharpRadius:.6,unsharpThreshold:2});case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),O=function(e){return new Promise((function(t,n){var r=new Image;r.src=URL.createObjectURL(e),r.onload=function(){t(r)},r.onerror=n}))},I=(n(46),function(){var e=Object(s.a)(u.a.mark((function e(t,n){var r,i,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.toDataURL(n,v.k),i=Object(a.c)("#"+v.a),c=Object(a.c)("#"+v.m),i.value=r.replace("data:"+n+";base64,",""),c.value=n;case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),E=function(e){var t=window.URL.createObjectURL(e),n=Object(a.c)("#"+v.o);n&&t&&(n.style.backgroundImage="url("+t+")")},x=function(e){var t=document.createElement("canvas"),n=v.j,r=v.j;if(e.width!==e.height){var a=Math.min(e.width,e.height)/v.j;n=Math.round(e.width/a),r=Math.round(e.height/a),e.width>e.height?(n=Math.min(n,v.i),r=Math.round(n*(e.height/e.width))):(r=Math.min(r,v.i),n=Math.round(r*(e.width/e.height)))}return t.width=n,t.height=r,t},L=function(){var e=Object(s.a)(u.a.mark((function e(t){var n,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.l.includes(t.type)){e.next=2;break}throw new p("Invalid file type",t.type);case 2:if(!(t.size>v.g)){e.next=4;break}throw new p("Invalid file size");case 4:return e.prev=4,E(t),e.next=8,O(t);case 8:if(!((n=e.sent).width<v.j||n.height<v.j)){e.next=11;break}throw new p("Invalid file min dimensions");case 11:return r=x(n),e.next=14,j(n,r);case 14:a=e.sent,I(a,t.type),e.next=22;break;case 18:throw e.prev=18,e.t0=e.catch(4),console.error("Error trying to process the file:",e.t0),e.t0;case 22:case"end":return e.stop()}}),e,null,[[4,18]])})));return function(t){return e.apply(this,arguments)}}(),y=(n(22),n(29)),k=function(e,t){Object(y.a)({description:e,options:Object.assign({},t||{})})},_=n(7),T=function(e){var t=Object(_.getRandomRange)(0,v.t.length-1);e.textContent=Object(h.a)(v.t[t])},R=function(){var e=document.getElementById(v.u);e&&(Object(a.c)("#"+v.n).classList.add("is-uploading"),T(e),r=setInterval((function(){return T(e)}),v.s))},M=function(){var e=Object(s.a)(u.a.mark((function e(t){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r&&clearInterval(r),g(),t){e.next=5;break}throw new p("Invalid file type","no_file");case 5:return R(),e.next=8,L(t);case 8:(n=Object(a.c)("#"+v.f))&&(n.value=""),d.a.goToSearchByImage(),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(0),w(e.t0),i={type:e.t0.message?m[e.t0.message].event:"unknown"},e.t0.fileExtension&&(i.file_extension=e.t0.fileExtension),k("searchImageError",i);case 19:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),S=function(e){e.preventDefault(),e.stopPropagation()};function U(e){S(e),this.classList.contains("is-uploading")||this.classList.add("is-dragover")}function A(e){S(e),this.classList.remove("is-dragover")}function C(e){return B.apply(this,arguments)}function B(){return(B=Object(s.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S(t),!this.classList.contains("is-uploading")){e.next=3;break}return e.abrupt("return");case 3:this.classList.remove("is-dragover"),n=t.dataTransfer&&t.dataTransfer.files[0],k("searchImageSelection",{type:"drop"}),M(n);case 7:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}var z=function(e){var t,n,r=Object(a.c)("form",e);r&&(null===(t=Object(a.c)("#"+v.f))||void 0===t||t.addEventListener("change",(function(e){var t,n=null===(t=e.target.files)||void 0===t?void 0:t[0];M(n),k("searchImageSelection",{type:"select"})})),("draggable"in(n=document.createElement("div"))||"ondragstart"in n&&"ondrop"in n)&&"FileReader"in window&&(r.classList.add("is-dragndrop-enabled"),r.addEventListener("dragover",U),r.addEventListener("dragleave",A),r.addEventListener("drop",C)))},F=function(){var e=Object(s.a)(u.a.mark((function e(){var t,r,i,s,o,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(a.c)("#"+v.p)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,n.e(86).then(n.t.bind(null,865,7));case 4:t=e.sent,r=t.default,i=Object(c.a)(),s=i.format,o=i.base64,(d=a.e.ModalInstance.print({name:"search-by-image",html:r({CSRF_TOKEN:CSRF_TOKEN,URL_STATIC_IMG:URL_STATIC_IMG,FILE_MIN_WIDTH_HEIGHT:v.j,FILE_MAX_SIZE_WITH_UNITS:v.h,TEXT_VALID_TYPES:v.q.join(", "),base64:o,format:s})},!1))&&(z(d),d.addEventListener("hide",g));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H=function(){var e;(e=Object(a.d)('[data-modal="'+v.r+'"]')).length>0&&e.forEach((function(e){e.addEventListener("click",Object(s.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k("searchImage"),F(),e.next=4,n.e(40).then(n.bind(null,864));case 4:(0,e.sent.searchByImageShowModal)(),k("searchImageModal");case 8:case"end":return e.stop()}}),e)}))))})),Object(c.b)()&&(F(),i())}}}]);
//# sourceMappingURL=64.f287e2730a134c3eff9cdac04b7c69fa.js.map